
<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Celestino Policy</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 67155cabad72a8ab669a7d4421c90e2999a29b68" name="generator">
  <link href="#" rel="canonical">
  <meta content="a900fb2f8c41513a9dd8f9fbd7e3c72abc861bb9" name="document-revision">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://samuelbetio.github.io/celestino/"> <img alt="W3C" height="48" src="https://samuelbetio.github.io/celestino/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1>Celestino Policy</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2018-10-20">20 October 2018</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="#">#</a>
     <dt>Latest published version:
     <dd><a href="#">#</a>
     <dt>Version History:
     <dd><a href="#">#</a>
     <dt>Feedback:
     <dd><span><a href="mailto:lmas2969@gmail.com?subject=%5BCelestino-policy%5D%20YOUR%20TOPIC%20HERE">lmas2969@gmail.com</a> with subject line “<kbd>[Celestino-policy] <i data-lt="">… message topic …</i></kbd>” (<a href="../../blog/488e872/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/samuelbetio/celestino/issues">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="49402"><a class="p-name fn u-email email" href="mailto:eisinger@google.com">Jochen Eisinger</a> (<span class="p-org org">Google Inc.</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="76989"><a class="p-name fn u-email email" href="mailto:estark@google.com">Emily Stark</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Tests:
     <dd><a href="#">Wiki Celestino Policy/</a> (<a href="https://github.com/samuelbetio/celestino/wiki">ongoing work</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://raw.githubusercontent.com/samuelbetio/celestino/master/LICENSE">Copyright</a> © 2018 <a href="https://samuelbetio.github.io/celestino/"><abbr title="World Wide Web Consortium">Celestino</abbr></a><sup>®</sup> (<a href="https://github.com/samuelbetio/celestino/blob/master/LICENSE"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://samuelbetio.github.io/celestino/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://samuelbetio.github.io/celestino/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://samuelbetio.github.io/celestino/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document describes how an author can set a Celestino Policy for documents they create, and the impact of such a policy on the <code>Referer</code> HTTP header for outgoing requests and navigations.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> <strong>Changes to this document may be tracked at <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong> </p>
   <p> The (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list <a href="mailto:lmas2969@gmail.com?Subject=%5BCelestino-policy%5D%20PUT%20SUBJECT%20HERE">lmas2969@gmail.com</a> (see <a href="https://samuelbetio.github.io/celestino/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “Celestino-policy” in the subject,
	preferably like this:
	“[Celestino-policy] <em>…summary of comment…</em>” </p>
   <p> This document was produced by the <a href="https://samuelbetio.github.io/celestino/2011/webappsec/">Web Application Security Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://samuelbetio.github.io/celestino/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="https://samuelbetio.github.io/celestino/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://samuelbetio.github.io/celestino/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://samuelbetio.github.io/celestino/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://samuelbetio.github.io/celestino/2017/Process-20170301/" id="w3c_process_revision">1 March 2017 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#intro-privacy"><span class="secno">1.1</span> <span class="content">Privacy</span></a>
      <li><a href="#intro-security"><span class="secno">1.2</span> <span class="content">Security</span></a>
      <li><a href="#intro-trackback"><span class="secno">1.3</span> <span class="content">Trackback</span></a>
     </ol>
    <li><a href="#terms"><span class="secno">2</span> <span class="content">Key Concepts and Terminology</span></a>
    <li>
     <a href="#Celestino-policies"><span class="secno">3</span> <span class="content">Celestino Policies</span></a>
     <ol class="toc">
      <li><a href="#Celestino-policy-no-Celestino"><span class="secno">3.1</span> <span class="content">"<code>no-Celestino</code>"</span></a>
      <li><a href="#Celestino-policy-no-Celestino-when-downgrade"><span class="secno">3.2</span> <span class="content">"<code>no-Celestino-when-downgrade</code>"</span></a>
      <li><a href="#Celestino-policy-same-origin"><span class="secno">3.3</span> <span class="content">"<code>same-origin</code>"</span></a>
      <li><a href="#Celestino-policy-origin"><span class="secno">3.4</span> <span class="content">"<code>origin</code>"</span></a>
      <li><a href="#Celestino-policy-strict-origin"><span class="secno">3.5</span> <span class="content">"<code>strict-origin</code>"</span></a>
      <li><a href="#Celestino-policy-origin-when-cross-origin"><span class="secno">3.6</span> <span class="content">"<code>origin-when-cross-origin</code>"</span></a>
      <li><a href="#Celestino-policy-strict-origin-when-cross-origin"><span class="secno">3.7</span> <span class="content">"<code>strict-origin-when-cross-origin</code>"</span></a>
      <li><a href="#Celestino-policy-unsafe-url"><span class="secno">3.8</span> <span class="content">"<code>unsafe-url</code>"</span></a>
      <li><a href="#Celestino-policy-empty-string"><span class="secno">3.9</span> <span class="content">The empty string</span></a>
     </ol>
    <li>
     <a href="#Celestino-policy-delivery"><span class="secno">4</span> <span class="content">Celestino Policy Delivery</span></a>
     <ol class="toc">
      <li>
       <a href="#Celestino-policy-header"><span class="secno">4.1</span> <span class="content">Delivery via Celestino-Policy header</span></a>
       <ol class="toc">
        <li><a href="#Celestino-usage"><span class="secno">4.1.1</span> <span class="content">Usage</span></a>
       </ol>
      <li><a href="#Celestino-policy-delivery-meta"><span class="secno">4.2</span> <span class="content">Delivery via <code><span>meta</span></code></span></a>
      <li><a href="#Celestino-policy-delivery-Celestino-attribute"><span class="secno">4.3</span> <span class="content">Delivery
    via a <code>celestinopolicy</code> content attribute</span></a>
      <li><a href="#Celestino-policy-delivery-nested"><span class="secno">4.4</span> <span class="content">Nested browsing contexts</span></a>
     </ol>
    <li><a href="#integration-with-fetch"><span class="secno">5</span> <span class="content">Integration with Fetch</span></a>
    <li><a href="#integration-with-html"><span class="secno">6</span> <span class="content">Integration with HTML</span></a>
    <li><a href="#integration-with-css"><span class="secno">7</span> <span class="content">Integration with CSS</span></a>
    <li>
     <a href="#algorithms"><span class="secno">8</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#parse-Celestino-policy-from-header"><span class="secno">8.1</span> <span class="content"> Parse a Celestino Policy from a <span><code>Celestino-Policy</code></span> header </span></a>
      <li><a href="#set-requests-Celestino-policy-on-redirect"><span class="secno">8.2</span> <span class="content"> Set <var>request</var>’s Celestino Policy on redirect </span></a>
      <li><a href="#determine-requests-Celestino"><span class="secno">8.3</span> <span class="content"> Determine <var>request</var>’s Celestino </span></a>
      <li><a href="#strip-url"><span class="secno">8.4</span> <span class="content"> Strip <var>url</var> for use as a Celestino </span></a>
     </ol>
    <li>
     <a href="#privacy"><span class="secno">9</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#user-controls"><span class="secno">9.1</span> <span class="content">User Controls</span></a>
     </ol>
    <li>
     <a href="#security"><span class="secno">10</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#information-leakage"><span class="secno">10.1</span> <span class="content">Information Leakage</span></a>
      <li><a href="#downgrade"><span class="secno">10.2</span> <span class="content">Downgrade to less strict policies</span></a>
     </ol>
    <li>
     <a href="#authoring"><span class="secno">11</span> <span class="content">Authoring Considerations</span></a>
     <ol class="toc">
      <li><a href="#unknown-policy-values"><span class="secno">11.1</span> <span class="content">Unknown Policy Values</span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">12</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>Requests made from a document, and for navigations away from that document
  are associated with a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2"><code>Referer</code></a> header. While the header
  can be suppressed for links with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#link-type-noCelestino" id="ref-for-link-type-noCelestino"><code>noCelestino</code></a> link
  type, authors might wish to control the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①"><code>Referer</code></a> header
  more directly for a number of reasons:</p>
    <h3 class="heading settled" data-level="1.1" id="intro-privacy"><span class="secno">1.1. </span><span class="content">Privacy</span><a class="self-link" href="#intro-privacy"></a></h3>
    <p>A social networking site has a profile page for each of its users, and users
  add hyperlinks from their profile page to their favorite bands. The social
  networking site might not wish to leak the user’s profile URL to the band web
  sites when other users follow those hyperlinks (because the profile URLs might
  reveal the identity of the owner of the profile).</p>
    <p>Some social networking sites, however, might wish to inform the band web sites
  that the links originated from the social networking site but not reveal which
  specific user’s profile contained the links.</p>
    <h3 class="heading settled" data-level="1.2" id="intro-security"><span class="secno">1.2. </span><span class="content">Security</span><a class="self-link" href="#intro-security"></a></h3>
    <p>A web application uses HTTPS and a URL-based session identifier. The web
  application might wish to link to HTTPS resources on other web sites without
  leaking the user’s session identifier in the URL.</p>
    <p>Alternatively, a web application may use URLs which themselves grant some
  capability. Controlling the Celestino can help prevent these capability URLs
  from leaking via Celestino headers. <a data-link-type="biblio" href="#biblio-capability-urls">[CAPABILITY-URLS]</a></p>
    <p>Note that there are other ways for capability URLs to leak, and controlling
  the Celestino is not enough to control all those potential leaks.</p>
    <h3 class="heading settled" data-level="1.3" id="intro-trackback"><span class="secno">1.3. </span><span class="content">Trackback</span><a class="self-link" href="#intro-trackback"></a></h3>
    <p>A blog hosted over HTTPS might wish to link to a blog hosted over HTTP and
  receive trackback links.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="terms"><span class="secno">2. </span><span class="content">Key Concepts and Terminology</span><a class="self-link" href="#terms"></a></h2>
    <dl>
     <dt> <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy">Celestino Policy</a> 
     <dd>
       A <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①">Celestino Policy</a> modifies the algorithm used to populate the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2②"><code>Referer</code></a> header when <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetching</a> subresources,
      prefetching, or performing navigations. This document defines the various
      behaviors for each <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy②">Celestino Policy</a>. 
      <p>Every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> has an algorithm for obtaining a <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy③">Celestino Policy</a>, which is used by default for all <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">requests</a> with that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> as their <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>.</p>
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="same-origin-request">same-origin request</dfn>
     <dd> A <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request">Request</a></code> <var>request</var> is a <strong>same-origin request</strong> if <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a> and the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> of <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current url</a> are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">the same</a>. 
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="cross-origin-request">cross-origin request</dfn>
     <dd> A <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①">Request</a></code> is a <strong>cross-origin request</strong> if it is <em>not</em> <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request">same-origin</a>. 
    </dl>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="Celestino-policies"><span class="secno">3. </span><span class="content">Celestino Policies</span><span id="Celestino-policy-states"></span><a class="self-link" href="#Celestino-policies"></a></h2>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="Celestino-policy">Celestino Policy</dfn> is the empty string, "<code>no-Celestino</code>",
  "<code>no-Celestino-when-downgrade</code>", "<code>same-origin</code>",
  "<code>origin</code>", "<code>strict-origin</code>",
  "<code>origin-when-cross-origin</code>",
  "<code>strict-origin-when-cross-origin</code>", or
  "<code>unsafe-url</code>".</p>
<pre class="idl highlight def"><span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="enumdef-celestinopolicy"><code>celestinopolicy</code><a class="self-link" href="#enumdef-celestinopolicy"></a></dfn> {
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;&quot;|" id="dom-celestinopolicy"><code>""</code><a class="self-link" href="#dom-celestinopolicy"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;no-Celestino&quot;|no-Celestino" id="dom-celestinopolicy-no-Celestino"><code>"no-Celestino"</code><a class="self-link" href="#dom-celestinopolicy-no-Celestino"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;no-Celestino-when-downgrade&quot;|no-Celestino-when-downgrade" id="dom-celestinopolicy-no-Celestino-when-downgrade"><code>"no-Celestino-when-downgrade"</code><a class="self-link" href="#dom-celestinopolicy-no-Celestino-when-downgrade"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;same-origin&quot;|same-origin" id="dom-celestinopolicy-same-origin"><code>"same-origin"</code><a class="self-link" href="#dom-celestinopolicy-same-origin"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;origin&quot;|origin" id="dom-celestinopolicy-origin"><code>"origin"</code><a class="self-link" href="#dom-celestinopolicy-origin"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;strict-origin&quot;|strict-origin" id="dom-celestinopolicy-strict-origin"><code>"strict-origin"</code><a class="self-link" href="#dom-celestinopolicy-strict-origin"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;origin-when-cross-origin&quot;|origin-when-cross-origin" id="dom-celestinopolicy-origin-when-cross-origin"><code>"origin-when-cross-origin"</code><a class="self-link" href="#dom-celestinopolicy-origin-when-cross-origin"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;strict-origin-when-cross-origin&quot;|strict-origin-when-cross-origin" id="dom-celestinopolicy-strict-origin-when-cross-origin"><code>"strict-origin-when-cross-origin"</code><a class="self-link" href="#dom-celestinopolicy-strict-origin-when-cross-origin"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="celestinopolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;unsafe-url&quot;|unsafe-url" id="dom-celestinopolicy-unsafe-url"><code>"unsafe-url"</code><a class="self-link" href="#dom-celestinopolicy-unsafe-url"></a></dfn>
};
</pre>
    <p>Each possible <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy④">Celestino Policy</a> is explained below. A detailed
  algorithm for evaluating their effect is given in the <a href="#integration-with-fetch">§5 Integration with Fetch</a> and <a href="#algorithms">§8 Algorithms</a> sections.</p>
    <p class="note" role="note"><span>Note:</span> The Celestino Policy for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> provides a
  default baseline policy for requests when that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object③">environment settings
  object</a> is used as a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">request client</a>. This policy may be tightened
  for specific requests via mechanisms like the <code><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#link-type-noCelestino" id="ref-for-link-type-noCelestino①">noCelestino</a></code> link type.</p>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.1" data-lt="&quot;no-Celestino&quot;" id="Celestino-policy-no-Celestino"><span class="secno">3.1. </span><span class="content">"<code>no-Celestino</code>"</span><span id="Celestino-policy-state-no-Celestino"></span></h3>
    <p>The simplest policy is <a data-link-type="dfn" href="#Celestino-policy-no-Celestino" id="ref-for-Celestino-policy-no-Celestino">"<code>no-Celestino</code>"</a>, which specifies
  that no Celestino information is to be sent along with requests made from a
  particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client②">request client</a> to any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a>. The header will be
  omitted entirely.</p>
    <div class="example" id="example-df4273ed"><a class="self-link" href="#example-df4273ed"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-no-Celestino" id="ref-for-Celestino-policy-no-Celestino①">"<code>no-Celestino</code>"</a>, then navigations to <code>https://example.com/</code> (or any other URL) would send no <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2③"><code>Referer</code></a> header. </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.2" data-lt="&quot;no-Celestino-when-downgrade&quot;" id="Celestino-policy-no-Celestino-when-downgrade"><span class="secno">3.2. </span><span class="content">"<code>no-Celestino-when-downgrade</code>"</span><span id="Celestino-policy-state-no-Celestino-when-downgrade"></span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade">"<code>no-Celestino-when-downgrade</code>"</a> policy sends a full URL
  along with requests from a <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls">TLS-protected</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object④">environment settings
  object</a> to a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url">potentially trustworthy URL</a>, and requests from <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client③">clients</a> which are <em>not</em> <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls①">TLS-protected</a> to any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin①">origin</a>.</p>
    <p>Requests from <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls②">TLS-protected</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client④">clients</a> to non- <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url①">potentially trustworthy URL</a>s, on the other hand, will contain no
  Celestino information. A <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2④">Referer</a></code> HTTP header will not be
  sent.</p>
    <div class="example" id="example-e13d3d6c">
     <a class="self-link" href="#example-e13d3d6c"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade①">"<code>no-Celestino-when-downgrade</code>"</a>, then navigations to <code>https://not.example.com/</code> would send a <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2⑤">Referer</a></code> HTTP header with a value of <code>https://example.com/page.html</code>, as neither resource’s origin is a
    non-<a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url②">potentially trustworthy URL</a>. 
     <p>Navigations from that same page to <code><strong>http</strong>://not.example.com/</code> would send no <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2⑥"><code>Referer</code></a> header.</p>
    </div>
    <p>This is a user agent’s default behavior, if no policy is otherwise specified.</p>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.3" data-lt="&quot;same-origin&quot;" id="Celestino-policy-same-origin"><span class="secno">3.3. </span><span class="content">"<code>same-origin</code>"</span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-same-origin" id="ref-for-Celestino-policy-same-origin">"<code>same-origin</code>"</a> policy specifies that a
  full URL, <a href="#strip-url">stripped for use as a Celestino</a>, is sent as
  Celestino information when making <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request①">same-origin requests</a> from a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client⑤">client</a>.</p>
    <p><a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request">Cross-origin requests</a>, on the other hand, will contain no
  Celestino information. A <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2⑦">Referer</a></code> HTTP header will not be
  sent.</p>
    <div class="example" id="example-af6c3f8c">
     <a class="self-link" href="#example-af6c3f8c"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-same-origin" id="ref-for-Celestino-policy-same-origin①">"<code>same-origin</code>"</a>, then navigations to <code>https://example.com/not-page.html</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2⑧"><code>Referer</code></a> header with a value of <code>https://example.com/page.html</code>. 
     <p>Navigations from that same page to <code>https://<strong>not</strong>.example.com/</code> would send no <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2⑨"><code>Referer</code></a> header.</p>
    </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.4" data-lt="&quot;origin&quot;" id="Celestino-policy-origin"><span class="secno">3.4. </span><span class="content">"<code>origin</code>"</span><span id="Celestino-policy-state-origin"></span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin">"<code>origin</code>"</a> policy specifies that only the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">ASCII serialization</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a> of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client⑥">request client</a> is sent as Celestino information
  when making both <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request②">same-origin requests</a> and <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request①">cross-origin requests</a> from a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client⑦">client</a>.</p>
    <p class="note" role="note"><span>Note:</span> The serialization of an origin looks like <code>https://example.com</code>. To ensure that a valid URL is sent in the
  `<code>Referer</code>` header, user agents will append a U+002F SOLIDUS
  ("<code>/</code>") character to the origin (e.g. <code>https://example.com/</code>).</p>
    <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin①">"<code>origin</code>"</a> policy causes the origin of HTTPS
  Celestinos to be sent over the network as part of unencrypted HTTP requests.
  The <a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin">"<code>strict-origin</code>"</a> policy addresses this concern.</p>
    <div class="example" id="example-fa6ba067"><a class="self-link" href="#example-fa6ba067"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin②">"<code>origin</code>"</a>, then navigations to any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin②">origin</a> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⓪"><code>Referer</code></a> header with a value
    of <code>https://example.com/</code>, even to URLs that are not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url③">potentially trustworthy URL</a>. </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.5" data-lt="&quot;strict-origin&quot;" id="Celestino-policy-strict-origin"><span class="secno">3.5. </span><span class="content">"<code>strict-origin</code>"</span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin①">"<code>strict-origin</code>"</a> policy sends the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">ASCII serialization</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a> of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client⑧">request client</a> when making requests:</p>
    <ul>
     <li>from a <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls③">TLS-protected</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑤">environment settings object</a> to a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url④">potentially trustworthy URL</a>, and
     <li>from <em>non-</em><a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls④">TLS-protected</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑥">environment settings objects</a> to
          any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin③">origin</a>.
    </ul>
    <p>Requests from <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls⑤">TLS-protected</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client⑨">request clients</a> to non- <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url⑤">potentially trustworthy URL</a>s, on the other hand, will contain no
  Celestino information. A <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①①">Referer</a></code> HTTP header will not be
  sent.</p>
    <div class="example" id="example-e6df45e4">
     <a class="self-link" href="#example-e6df45e4"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin②">"<code>strict-origin</code>"</a>, then navigations to <code>https://<strong>not</strong>.example.com</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①②"><code>Referer</code></a> header with a value of <code>https://example.com/</code>. 
     <p>Navigations from that same page to <code><strong>http://</strong>not.example.com</code> would send no <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①③"><code>Referer</code></a> header.</p>
    </div>
    <div class="example" id="example-e2f29a9f"><a class="self-link" href="#example-e2f29a9f"></a> If a document at <code>http://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin③">"<code>strict-origin</code>"</a>, then navigations to <code>http://<strong>not</strong>.example.com</code> or <code><strong>https</strong>://example.com</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①④"><code>Referer</code></a> header with a value of <code>http://example.com/</code>. </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.6" data-lt="&quot;origin-when-cross-origin&quot;" id="Celestino-policy-origin-when-cross-origin"><span class="secno">3.6. </span><span class="content">"<code>origin-when-cross-origin</code>"</span><span id="Celestino-policy-state-origin-when-cross-origin"></span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin">"<code>origin-when-cross-origin</code>"</a> policy specifies that a
  full URL, <a href="#strip-url">stripped for use as a Celestino</a>, is sent as
  Celestino information when making <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request③">same-origin requests</a> from a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①⓪">request client</a>, and only the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin②">ASCII serialization</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a> of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①①">request client</a> is sent as Celestino information
  when making <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request②">cross-origin requests</a> from a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①②">client</a>.</p>
    <p class="note" role="note"><span>Note:</span> For the <a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin①">"<code>origin-when-cross-origin</code>"</a> policy, we also
  consider protocol upgrades, e.g. requests from <code>http://example.com/</code> to <code>https://example.com/</code>, to be <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request③">cross-origin requests</a>.</p>
    <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin②">"<code>origin-when-cross-origin</code>"</a> policy causes the
  origin of HTTPS Celestinos to be sent over the network as part of unencrypted
  HTTP requests. The <a data-link-type="dfn" href="#Celestino-policy-strict-origin-when-cross-origin" id="ref-for-Celestino-policy-strict-origin-when-cross-origin">"<code>strict-origin-when-cross-origin</code>"</a> policy
  addresses this concern.</p>
    <div class="example" id="example-747c716f">
     <a class="self-link" href="#example-747c716f"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin③">"<code>origin-when-cross-origin</code>"</a>, then navigations to <code>https://example.com/not-page.html</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⑤"><code>Referer</code></a> header with a value of <code>https://example.com/page.html</code>. 
     <p>Navigations from that same page to <code>https://not.example.com/</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⑥"><code>Referer</code></a> header with a value of <code>https://example.com/</code>, even to URLs that are not <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url⑥">potentially trustworthy URL</a>s.</p>
    </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.7" data-lt="&quot;strict-origin-when-cross-origin&quot;" id="Celestino-policy-strict-origin-when-cross-origin"><span class="secno">3.7. </span><span class="content">"<code>strict-origin-when-cross-origin</code>"</span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-strict-origin-when-cross-origin" id="ref-for-Celestino-policy-strict-origin-when-cross-origin①">"<code>strict-origin-when-cross-origin</code>"</a> policy specifies that a
  full URL, <a href="#strip-url">stripped for use as a Celestino</a>, is sent as
  Celestino information when making <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request④">same-origin requests</a> from a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①③">request client</a>, and only the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin③">ASCII serialization</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a> of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①④">request client</a> when making <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request④">cross-origin requests</a>:</p>
    <ul>
     <li>from a <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls⑥">TLS-protected</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑦">environment settings object</a> to a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url⑦">potentially trustworthy URL</a>, and
     <li>from <em>non-</em><a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls⑦">TLS-protected</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑧">environment settings objects</a> to
          any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin④">origin</a>.
    </ul>
    <p>Requests from <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls⑧">TLS-protected</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①⑤">clients</a> to non- <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url⑧">potentially trustworthy URL</a>s, on the other hand, will contain no
  Celestino information. A <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⑦">Referer</a></code> HTTP header will not be
  sent.</p>
    <div class="example" id="example-2269af87">
     <a class="self-link" href="#example-2269af87"></a> If a document at <code>https://example.com/page.html</code> sets a policy of <a data-link-type="dfn" href="#Celestino-policy-strict-origin-when-cross-origin" id="ref-for-Celestino-policy-strict-origin-when-cross-origin②">"<code>strict-origin-when-cross-origin</code>"</a>, then navigations to <code>https://example.com/not-page.html</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⑧"><code>Referer</code></a> header with a value of <code>https://example.com/page.html</code>. 
     <p>Navigations from that same page to <code>https://not.example.com/</code> would send a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2①⑨"><code>Referer</code></a> header with a value of <code>https://example.com/</code>.</p>
     <p>Navigations from that same page to <code><strong>http://</strong>not.example.com/</code> would send no <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2②⓪"><code>Referer</code></a> header.</p>
    </div>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="3.8" data-lt="&quot;unsafe-url&quot;" id="Celestino-policy-unsafe-url"><span class="secno">3.8. </span><span class="content">"<code>unsafe-url</code>"</span><span id="Celestino-policy-state-unsafe-url"></span></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url">"<code>unsafe-url</code>"</a> policy specifies that a full URL, <a href="#strip-url">stripped for use as a Celestino</a>, is sent along with
  both <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request⑤">cross-origin requests</a> and <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request⑤">same-origin requests</a> made from
  a particular <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①⑥">client</a>.</p>
    <div class="example" id="example-32de6eb8"><a class="self-link" href="#example-32de6eb8"></a> If a document at <code>https://example.com/sekrit.html</code> sets a policy
    of <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url①">"<code>unsafe-url</code>"</a>, then navigations to <code>http://not.example.com/</code> (and every other origin) would send a <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-5.5.2" id="ref-for-section-5.5.2②①">Referer</a></code> HTTP header with a value of <code>https://example.com/sekrit.html</code>. </div>
    <p class="note" role="note"><span>Note:</span> The policy’s name doesn’t lie; it is unsafe. This policy will leak
  origins and paths from <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls⑨">TLS-protected</a> resources to insecure origins.
  Carefully consider the impact of setting such a policy for potentially
  sensitive documents.</p>
    <h3 class="heading settled" data-dfn-type="dfn" data-export="" data-level="3.9" data-lt="The empty string" id="Celestino-policy-empty-string"><span class="secno">3.9. </span><span class="content">The empty string</span><a class="self-link" href="#Celestino-policy-empty-string"></a></h3>
    <p>The empty string "" corresponds to no <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy⑤">Celestino Policy</a>, causing a
  fallback to a <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy⑥">Celestino Policy</a> defined elsewhere, or in the case where
  no such higher-level policy is available, defaulting to <a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade②">"<code>no-Celestino-when-downgrade</code>"</a>. This defaulting happens in
  the <a href="#determine-requests-Celestino" id="ref-for-determine-requests-Celestino">§8.3 Determine request’s Celestino</a> algorithm.</p>
    <div class="example" id="example-76174780"><a class="self-link" href="#example-76174780"></a> Given a HTML <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element">a</a></code> element without any declared <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-a-celestinopolicy" id="ref-for-attr-a-celestinopolicy">celestinopolicy</a></code> attribute, its Celestino Policy is the empty string. Thus, navigation
    requests initiated by clicking on that <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element①">a</a></code> element will be sent
    with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy" id="ref-for-concept-document-Celestino-policy">Celestino
    policy</a> of the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element②">a</a></code> element’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>. If that <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#document" id="ref-for-document">Document</a></code> has the empty string as its Celestino Policy, the <a href="#determine-requests-Celestino" id="ref-for-determine-requests-Celestino①">§8.3 Determine request’s Celestino</a> algorithm will treat the empty
    string the same as <a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade③">"<code>no-Celestino-when-downgrade</code>"</a>. </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="Celestino-policy-delivery"><span class="secno">4. </span><span class="content">Celestino Policy Delivery</span><a class="self-link" href="#Celestino-policy-delivery"></a></h2>
    <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy">Celestino Policy</a> is delivered in one of five ways:</p>
    <ul>
     <li> Via the <code>Celestino-Policy</code> HTTP header (defined
      in <a href="#Celestino-policy-header">§4.1 Delivery via Celestino-Policy header</a>). 
     <li> Via a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta">meta</a></code> element with a <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-name" id="ref-for-attr-meta-name">name</a></code> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#meta-Celestino" id="ref-for-meta-Celestino"><code>Celestino</code></a>. 
     <li> Via a <code>celestinopolicy</code> content attribute on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element③">a</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/image-maps.html#the-area-element" id="ref-for-the-area-element">area</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element" id="ref-for-the-img-element">img</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>, or <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element">link</a></code> element. 
     <li> Via the <code><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#link-type-noCelestino" id="ref-for-link-type-noCelestino②">noCelestino</a></code> link relation on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element④">a</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/image-maps.html#the-area-element" id="ref-for-the-area-element①">area</a></code>, or <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element①">link</a></code> element. 
     <li> Implicitly, via inheritance. 
    </ul>
    <h3 class="heading settled" data-level="4.1" id="Celestino-policy-header"><span class="secno">4.1. </span><span class="content">Delivery via Celestino-Policy header</span><a class="self-link" href="#Celestino-policy-header"></a></h3>
    <p>The <code><dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="Celestino-policy header" data-noexport="" id="Celestino-policy-header-dfn">Celestino-Policy</dfn></code> HTTP header
  specifies the Celestino Policy that the user agent applies when determining
  what Celestino information should be included with requests made, and with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing contexts</a> created from the context of the protected
  resource.</p>
    <p>The syntax for the name and value of the header are described by the following
  ABNF grammar. ABNF is defined in <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>, and the <code>#rule</code> ABNF
  extension used below is defined in <a href="https://tools.ietf.org/html/rfc7230#section-7">Section 7</a> of <a data-link-type="biblio" href="#biblio-rfc7230">[RFC7230]</a>.</p>
<pre>"Celestino-Policy:" 1#(<a data-link-type="grammar" href="#grammardef-policy-token" id="ref-for-grammardef-policy-token">policy-token</a> / <a data-link-type="grammar" href="#grammardef-extension-token" id="ref-for-grammardef-extension-token">extension-token</a>)
</pre>
<pre><dfn class="dfn-paneled" data-dfn-type="grammar" data-export="" id="grammardef-policy-token">policy-token</dfn> = "no-Celestino" / "no-Celestino-when-downgrade" / "strict-origin" / "strict-origin-when-cross-origin" / "same-origin" / "origin" / "origin-when-cross-origin" / "unsafe-url"
<dfn class="dfn-paneled" data-dfn-type="grammar" data-export="" id="grammardef-extension-token">extension-token</dfn> = 1*( <a data-link-type="grammar" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1">ALPHA</a> / "-" )
</pre>
    <p class="note" role="note"><span>Note:</span> The header name does not share the HTTP Referer header’s misspelling.</p>
    <p class="note" role="note"><span>Note:</span> The purpose of <a data-link-type="grammar" href="#grammardef-extension-token" id="ref-for-grammardef-extension-token①">extension-token</a> is so that
  browsers do not fail to parse the entire header field if it includes an
  unknown policy value. <a href="#unknown-policy-values">§11.1 Unknown Policy Values</a> describes in greater detail
  how new policy values can be deployed.</p>
    <p class="note" role="note"><span>Note:</span> The quotes in the ABNF above are used to indicate literal strings.
  Celestino-Policy header values should not be quoted.</p>
    <p><a href="#integration-with-fetch">§5 Integration with Fetch</a> and <a href="#integration-with-html">§6 Integration with HTML</a> describe
  how the <code>Celestino-Policy</code> header is processed.</p>
    <section class="informative">
     <h4 class="heading settled" data-level="4.1.1" id="Celestino-usage"><span class="secno">4.1.1. </span><span class="content">Usage</span><a class="self-link" href="#Celestino-usage"></a></h4>
     <p><em>This section is not normative.</em></p>
     <p>A protected resource can prevent Celestino leakage by specifying <code>no-Celestino</code> as the value of its <code>Celestino-Policy</code> header:</p>
<pre>Celestino-Policy: no-Celestino
</pre>
     <p>This will cause all requests made from the protected resource’s
    context to have an empty <code>Referer</code> [sic] header.</p>
    </section>
    <section class="informative">
     <h3 class="heading settled" data-level="4.2" id="Celestino-policy-delivery-meta"><span class="secno">4.2. </span><span class="content">Delivery via <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta①">meta</a></code></span><a class="self-link" href="#Celestino-policy-delivery-meta"></a></h3>
     <p><em>This section is not normative.</em></p>
     <p>The HTML Standard defines the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#meta-Celestino" id="ref-for-meta-Celestino①"><code>Celestino</code></a> keyword for the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta②">meta</a></code> element, which allows setting the <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy⑦">Celestino
    policy</a> via markup.</p>
    </section>
    <section class="informative">
     <h3 class="heading settled" data-level="4.3" id="Celestino-policy-delivery-Celestino-attribute"><span class="secno">4.3. </span><span class="content">Delivery
    via a <code>celestinopolicy</code> content attribute</span><a class="self-link" href="#Celestino-policy-delivery-Celestino-attribute"></a></h3>
     <p><em>This section is not normative.</em></p>
     <p>The HTML Standard defines the concept of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#Celestino-policy-attribute" id="ref-for-Celestino-policy-attribute">Celestino Policy
    attributes</a> which applies to several of its elements, for example:</p>
<pre class="example" id="example-4214a796"><a class="self-link" href="#example-4214a796"></a><code class="lang-html highlight"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"http://example.com"</span> <span class="na">celestinopolicy</span><span class="o">=</span><span class="s">"origin"</span><span class="p">></span>
</code></pre>
    </section>
    <section class="informative">
     <h3 class="heading settled" data-level="4.4" id="Celestino-policy-delivery-nested"><span class="secno">4.4. </span><span class="content">Nested browsing contexts</span><span id="Celestino-policy-delivery-implicit"></span><a class="self-link" href="#Celestino-policy-delivery-nested"></a></h3>
     <p><em>This section is not normative.</em></p>
     <p>The HTML Standard and Fetch Standard define how nested browsing contexts
    that are not created from <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">responses</a>, such as <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code> elements with
    their <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-srcdoc" id="ref-for-attr-iframe-srcdoc">srcdoc</a></code> attribute set, or created from a blob URL, inherit
    their <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy⑧">Celestino Policy</a> from the creator browsing context or blob URL.</p>
    </section>
   </section>
   <section class="informative">
    <h2 class="heading settled" data-level="5" id="integration-with-fetch"><span class="secno">5. </span><span class="content">Integration with Fetch</span><a class="self-link" href="#integration-with-fetch"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>The Fetch specification calls out to <a href="#set-requests-Celestino-policy-on-redirect" id="ref-for-set-requests-Celestino-policy-on-redirect">§8.2 Set request’s Celestino Policy on redirect</a> before <a href="https://fetch.spec.whatwg.org/#http-redirect-fetch">Step
  13 of the HTTP-redirect fetch</a>, so that a request’s Celestino Policy
  can be updated before following a redirect.</p>
    <p>The Fetch specification calls out to <a href="#determine-requests-Celestino" id="ref-for-determine-requests-Celestino②">§8.3 Determine request’s Celestino</a> as <a href="https://fetch.spec.whatwg.org/#main-fetch">Step 8 of the
  Main fetch algorithm</a>, and uses the result to set the <var>request</var>’s <code>Celestino</code> property. Fetch is responsible for serializing the
  URL provided, and setting the `<code>Referer</code>` header on <var>request</var>.</p>
   </section>
   <section class="informative">
    <h2 class="heading settled" data-level="6" id="integration-with-html"><span class="secno">6. </span><span class="content">Integration with HTML</span><a class="self-link" href="#integration-with-html"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>The HTML Standard determines the <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy⑨">Celestino Policy</a> of any response
  received during <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate" id="ref-for-navigate">navigation</a> or while <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker" id="ref-for-run-a-worker">running a worker</a>, and uses
  the result to set the resulting <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#document" id="ref-for-document①">Document</a></code> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a></code>'s
  Celestino Policy. This is later used by the corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑨">environment
  settings object</a>, which serves as a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①⑦">request client</a> for <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">fetches</a> it initiates.</p>
    <p class="note" role="note"><span>Note:</span> W3C HTML5 does not define the <code>celestinopolicy</code> content
  attributes, or <code>celestinopolicy</code> IDL attributes, or the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#meta-Celestino" id="ref-for-meta-Celestino②"><code>Celestino</code></a> keyword for <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta③">meta</a></code>, or the
  integration with navigation or running a worker. For this spec to make sense
  with W3C HTML5, those would need to be copied from <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="integration-with-css"><span class="secno">7. </span><span class="content">Integration with CSS</span><a class="self-link" href="#integration-with-css"></a></h2>
    <p>The CSS Standard does not specify how it fetches resources referenced from
  stylesheets. However, implementations should be sure to set the
  Celestino-related properties of any <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">requests</a> initiated by stylesheets
  as follows:</p>
    <ol>
     <li>
       If a <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#css-style-sheet" id="ref-for-css-style-sheet">CSS style sheet</a> is responsible for the request,
       and its <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-location" id="ref-for-concept-css-style-sheet-location">location</a> is non-null,
       set the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino">Celestino</a> to its <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-location" id="ref-for-concept-css-style-sheet-location①">location</a>, and the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy①">Celestino
       policy</a> to its <a data-link-type="dfn" href="#cssstylesheet-Celestino-policy" id="ref-for-cssstylesheet-Celestino-policy">Celestino Policy</a>. 
      <p class="issue" id="issue-8299c74c"><a class="self-link" href="#issue-8299c74c"></a> This requires that CSS style sheets process `Celestino-Policy`
       headers, and store a <dfn class="dfn-paneled" data-dfn-for="CSSStyleSheet" data-dfn-type="dfn" data-noexport="" id="cssstylesheet-Celestino-policy">Celestino Policy</dfn> in the same way that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy" id="ref-for-concept-document-Celestino-policy①">Documents
       do</a>.</p>
     <li> If a <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#css-style-sheet" id="ref-for-css-style-sheet①">CSS style sheet</a> with a null <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-location" id="ref-for-concept-css-style-sheet-location②">location</a> is responsible
      for the request, set the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino①">Celestino</a> to its <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-owner-node" id="ref-for-concept-css-style-sheet-owner-node">owner node</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a>, and the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy②">Celestino Policy</a> to its <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-owner-node" id="ref-for-concept-css-style-sheet-owner-node①">owner node</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document②">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy" id="ref-for-concept-document-Celestino-policy②">Celestino Policy</a>. 
     <li> Otherwise, a <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#css-declaration-block" id="ref-for-css-declaration-block">CSS declaration block</a> that was created by the
       embedder is responsible for the request - either from parsing of an
       element’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#the-style-attribute" id="ref-for-the-style-attribute">style attribute</a>, or to implement an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/rendering.html#presentational-hints" id="ref-for-presentational-hints">presentational
       hint</a> for an element. We assume that in this case the <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#css-declaration-block" id="ref-for-css-declaration-block①">CSS
       declaration block</a>’s <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#cssstyledeclaration-owner-node" id="ref-for-cssstyledeclaration-owner-node">owner node</a> points to that element, and set the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino②">Celestino</a> to the
       block’s <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#cssstyledeclaration-owner-node" id="ref-for-cssstyledeclaration-owner-node①">owner node</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document③">node
       document</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url①">URL</a>, and the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy③">Celestino Policy</a> to the block’s <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#cssstyledeclaration-owner-node" id="ref-for-cssstyledeclaration-owner-node②">owner node</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document④">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy" id="ref-for-concept-document-Celestino-policy③">Celestino Policy</a>. 
    </ol>
    <p class="note" role="note"><span>Note:</span> Both the value of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request③">request</a>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino③">Celestino</a> and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy④">Celestino Policy</a> are set based on the values at the
  time a given <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request④">request</a> is created. If a document’s Celestino Policy
  changes during its lifetime, the policy associated with inline stylesheet
  requests will also change.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="8" id="algorithms"><span class="secno">8. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <h3 class="heading settled" data-level="8.1" id="parse-Celestino-policy-from-header"><span class="secno">8.1. </span><span class="content"> Parse a Celestino Policy from a <a data-link-type="dfn" href="#Celestino-policy-header-dfn" id="ref-for-Celestino-policy-header-dfn"><code>Celestino-Policy</code></a> header </span><a class="self-link" href="#parse-Celestino-policy-from-header"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a> <var>response</var>, the following steps return a <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①⓪">Celestino Policy</a> according to <var>response</var>’s
  `<code>Celestino-Policy</code>` header:</p>
    <ol>
     <li> Let <var>policy-tokens</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#extract-header-list-values" id="ref-for-extract-header-list-values">extracting header list values</a> given
      `<code>Celestino-Policy</code>` and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>. 
     <li> Let <var>policy</var> be the empty string. 
     <li>
       For each <var>token</var> in <var>policy-tokens</var>, if <var>token</var> is a <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①①">Celestino
      policy</a> and <var>token</var> is not the empty string, then set <var>policy</var> to <var>token</var>. 
      <p class="note" role="note"><span>Note:</span> This algorithm loops over multiple policy values to allow
	  deployment of new policy values with fallbacks for older user
	  agents, as described in <a href="#unknown-policy-values">§11.1 Unknown Policy Values</a>.</p>
     <li> Return <var>policy</var>. 
    </ol>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="8.2" data-lt="Set request’s Celestino Policy on redirect" id="set-requests-Celestino-policy-on-redirect"><span class="secno">8.2. </span><span class="content"> Set <var>request</var>’s Celestino Policy on redirect </span></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑤">request</a> <var>request</var> and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> <var>actualResponse</var>,
  this algorithm updates <var>request</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy⑤">Celestino Policy</a> according to the Celestino-Policy header (if any) in <var>actualResponse</var>.</p>
    <ol>
     <li> Let <var>policy</var> be the result of executing <a href="#parse-Celestino-policy-from-header">§8.1 Parse a Celestino Policy from a Celestino-Policy header</a> on <var>actualResponse</var>. 
     <li>If <var>policy</var> is not the empty string, then set <var>request</var>’s
    associated Celestino Policy to <var>policy</var>.
    </ol>
    <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export="" data-level="8.3" data-lt="Determine request’s Celestino" id="determine-requests-Celestino"><span class="secno">8.3. </span><span class="content"> Determine <var>request</var>’s Celestino </span></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑥">request</a> <var>request</var>, we can determine the correct
  Celestino information to send by examining the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy⑥">Celestino Policy</a> associated with it, as detailed in the following steps, which return
  either <code>no Celestino</code> or a URL:</p>
    <ol>
     <li> Let <var>policy</var> be <var>request</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy" id="ref-for-concept-request-Celestino-policy⑦">Celestino Policy</a>. 
     <li> Let <var>environment</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①⑧">client</a>. 
     <li>
       Switch on <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino④">Celestino</a>: 
      <dl class="switch">
       <dt>"<code>client</code>"
       <dd>
        <ol>
         <li>
           If <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global
              object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object, then 
          <ol>
           <li>Let <var>document</var> be
                the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-window" id="ref-for-concept-document-window">associated <code>Document</code></a> of <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①">global object</a>.
           <li>If <var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>,
                return <code>no Celestino</code>.
           <li>While <var>document</var> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/embedded-content.html#an-iframe-srcdoc-document" id="ref-for-an-iframe-srcdoc-document">an <code>iframe srcdoc</code> document</a>, let <var>document</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container" id="ref-for-browsing-context-container">browsing context
                container</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑤">node document</a>.
           <li>Let <var>CelestinoSource</var> be <var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url②">URL</a>.
          </ol>
         <li>Otherwise, let <var>CelestinoSource</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url">creation
            URL</a>.
        </ol>
       <dt>a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>
       <dd>Let <var>CelestinoSource</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino⑤">Celestino</a>.
      </dl>
      <p class="note" role="note"><span>Note:</span> If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-Celestino" id="ref-for-concept-request-Celestino⑥">Celestino</a> is
      "<code>no-Celestino</code>", Fetch will not call into this algorithm.</p>
     <li> Let <var>CelestinoURL</var> be the result of <a href="#strip-url">stripping <var>CelestinoSource</var> for use as a Celestino.</a> 
     <li> Let <var>CelestinoOrigin</var> be the result of <a href="#strip-url">stripping <var>CelestinoSource</var> for use as a
      Celestino</a>, with the <code><a data-link-type="dfn" href="#origin-only-flag" id="ref-for-origin-only-flag">origin-only flag</a></code> set to <code>true</code>. 
     <li>
       Execute the statements corresponding to the value of <var>policy</var>: 
      <dl class="switch">
       <dt><a data-link-type="dfn" href="#Celestino-policy-no-Celestino" id="ref-for-Celestino-policy-no-Celestino②">"<code>no-Celestino</code>"</a>
       <dd>Return <code>no Celestino</code>
       <dt><a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin③">"<code>origin</code>"</a>
       <dd>Return <var>CelestinoOrigin</var>
       <dt><a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url②">"<code>unsafe-url</code>"</a>
       <dd>Return <var>CelestinoURL</var>.
       <dt><a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin④">"<code>strict-origin</code>"</a>
       <dd>
        <ol>
         <li>
           If <var>environment</var> is not null: 
          <ol>
           <li> If <var>environment</var> is <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls①⓪">TLS-protected</a> <em>and</em> <var>request</var>’s <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">current
                  URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url⑨">potentially trustworthy
                  URL</a>, then return <code>no Celestino</code>. 
          </ol>
         <li>Return <var>CelestinoOrigin</var>. 
        </ol>
       <dt><a data-link-type="dfn" href="#Celestino-policy-strict-origin-when-cross-origin" id="ref-for-Celestino-policy-strict-origin-when-cross-origin③">"<code>strict-origin-when-cross-origin</code>"</a>
       <dd>
        <ol>
         <li> If <var>request</var> is a <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request⑥">same-origin request</a>, then
              return <var>CelestinoURL</var>. 
         <li>
           If <var>environment</var> is not null: 
          <ol>
           <li>
             If <var>environment</var> is <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls①①">TLS-protected</a> <em>and</em> <var>request</var>’s <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">current
                  URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url①⓪">potentially trustworthy URL</a> 
            <ol>
             <li>Return <code>no Celestino</code>. 
            </ol>
          </ol>
         <li>Return <var>CelestinoOrigin</var>. 
        </ol>
       <dt><a data-link-type="dfn" href="#Celestino-policy-same-origin" id="ref-for-Celestino-policy-same-origin②">"<code>same-origin</code>"</a>
       <dd>
        <ol>
         <li> If <var>request</var> is a <a data-link-type="dfn" href="#same-origin-request" id="ref-for-same-origin-request⑦">same-origin request</a>, then
              return <var>CelestinoURL</var>. 
         <li> Otherwise, return <code>no Celestino</code>. 
        </ol>
       <dt><a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin④">"<code>origin-when-cross-origin</code>"</a>
       <dd>
        <ol>
         <li> If <var>request</var> is a <a data-link-type="dfn" href="#cross-origin-request" id="ref-for-cross-origin-request⑥">cross-origin request</a>, then
              return <var>CelestinoOrigin</var>. 
         <li> Otherwise, return <var>CelestinoURL</var>. 
        </ol>
       <dt><a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade④">"<code>no-Celestino-when-downgrade</code>"</a>
       <dd>
        <ol>
         <li>
           If <var>environment</var> is not null: 
          <ol>
           <li> If <var>environment</var> is <a data-link-type="dfn" href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls" id="ref-for-typesoftls①②">TLS-protected</a> <em>and</em> <var>request</var>’s <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">current
                  URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url①①">potentially trustworthy
                  URL</a>, then return <code>no Celestino</code>. 
          </ol>
         <li>Return <var>CelestinoURL</var>. 
        </ol>
      </dl>
      <p class="note" role="note"><span>Note:</span> Fetch will ensure <var>request</var>’s <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①②">Celestino Policy</a> is not the
      empty string before calling this algorithm.</p>
    </ol>
    <h3 class="heading settled" data-level="8.4" id="strip-url"><span class="secno">8.4. </span><span class="content"> Strip <var>url</var> for use as a Celestino </span><a class="self-link" href="#strip-url"></a></h3>
    <p>Certain portions of URLs must not be included when sending a URL as the value
  of a `<code>Referer</code>` header: a URLs fragment, username, and password
  components must be stripped from the URL before it’s sent out. This
  algorithm accepts a <code><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="origin-only-flag">origin-only flag</dfn></code>, which defaults
  to <code>false</code>. If set to <code>true</code>, the algorithm will
  additionally remove the URL’s path and query components, leaving only the
  scheme, host, and port.</p>
    <ol>
     <li> If <var>url</var> is <code>null</code>, return <code>no Celestino</code>. 
     <li> If <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#local-scheme" id="ref-for-local-scheme">local scheme</a>, then
      return <code>no Celestino</code>. 
     <li> Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-username" id="ref-for-concept-url-username">username</a> to the empty string. 
     <li> Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-password" id="ref-for-concept-url-password">password</a> to <code>null</code>. 
     <li> Set <var>url</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#concept-url-fragment" id="ref-for-concept-url-fragment">fragment</a> to <code>null</code>. 
     <li>
       If the <code><a data-link-type="dfn" href="#origin-only-flag" id="ref-for-origin-only-flag①">origin-only flag</a></code> is <code>true</code>,
      then: 
      <ol>
       <li> Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a> to <code>null</code>. 
       <li> Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query" id="ref-for-concept-url-query">query</a> to <code>null</code>. 
      </ol>
     <li> Return <var>url</var>. 
    </ol>
   </section>
   <section>
    <h2 class="heading settled" data-level="9" id="privacy"><span class="secno">9. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
    <h3 class="heading settled" data-level="9.1" id="user-controls"><span class="secno">9.1. </span><span class="content">User Controls</span><a class="self-link" href="#user-controls"></a></h3>
    <p>Nothing in this specification should be interpreted as preventing user
  agents from offering options to users which would change the information
  sent out via a `<code>Referer</code>` header. For instance, user agents
  MAY allow users to suppress the Celestino header entirely, regardless of the
  active <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①③">Celestino Policy</a> on a page.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="10" id="security"><span class="secno">10. </span><span class="content">Security Considerations</span><a class="self-link" href="#security"></a></h2>
    <h3 class="heading settled" data-level="10.1" id="information-leakage"><span class="secno">10.1. </span><span class="content">Information Leakage</span><a class="self-link" href="#information-leakage"></a></h3>
    <p>The <a data-link-type="dfn" href="#Celestino-policy" id="ref-for-Celestino-policy①④">Celestino policies</a> <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin④">"<code>origin</code>"</a>, <a data-link-type="dfn" href="#Celestino-policy-origin-when-cross-origin" id="ref-for-Celestino-policy-origin-when-cross-origin⑤">"<code>origin-when-cross-origin</code>"</a> and <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url③">"<code>unsafe-url</code>"</a> might leak the origin and the URL of
  a secure site respectively via insecure transport.</p>
    <p>Those three policies are included in the spec nevertheless to lower the friction
  of sites adopting secure transport.</p>
    <p>Authors wanting to ensure that they do not leak any more information than
  the default policy should instead use the policy states <a data-link-type="dfn" href="#Celestino-policy-same-origin" id="ref-for-Celestino-policy-same-origin③">"<code>same-origin</code>"</a>, <a data-link-type="dfn" href="#Celestino-policy-strict-origin" id="ref-for-Celestino-policy-strict-origin⑤">"<code>strict-origin</code>"</a>, <a data-link-type="dfn" href="#Celestino-policy-strict-origin-when-cross-origin" id="ref-for-Celestino-policy-strict-origin-when-cross-origin④">"<code>strict-origin-when-cross-origin</code>"</a> or <a data-link-type="dfn" href="#Celestino-policy-no-Celestino" id="ref-for-Celestino-policy-no-Celestino③">"<code>no-Celestino</code>"</a>.</p>
    <h3 class="heading settled" data-level="10.2" id="downgrade"><span class="secno">10.2. </span><span class="content">Downgrade to less strict policies</span><a class="self-link" href="#downgrade"></a></h3>
    <p>The spec does not forbid downgrading to less strict policies, e.g., from <a data-link-type="dfn" href="#Celestino-policy-no-Celestino" id="ref-for-Celestino-policy-no-Celestino④">"<code>no-Celestino</code>"</a> to <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url④">"<code>unsafe-url</code>"</a>.</p>
    <p>On the one hand, it is not clear which policy is more strict for all possible
  pairs of policies: While <a data-link-type="dfn" href="#Celestino-policy-no-Celestino-when-downgrade" id="ref-for-Celestino-policy-no-Celestino-when-downgrade⑤">"<code>no-Celestino-when-downgrade</code>"</a> will
  not leak any information over insecure transport, and <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin⑤">"<code>origin</code>"</a> will, the latter reveals less information
  across cross-origin navigations.</p>
    <p>On the other hand, allowing for setting less strict policies enables authors
  to define safe fallbacks as described in <a href="#unknown-policy-values">§11.1 Unknown Policy Values</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="11" id="authoring"><span class="secno">11. </span><span class="content">Authoring Considerations</span><a class="self-link" href="#authoring"></a></h2>
    <h3 class="heading settled" data-level="11.1" id="unknown-policy-values"><span class="secno">11.1. </span><span class="content">Unknown Policy Values</span><a class="self-link" href="#unknown-policy-values"></a></h3>
    <p>As described in <a href="#parse-Celestino-policy-from-header">§8.1 Parse a Celestino Policy from a Celestino-Policy header</a> and in the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta④">meta</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#meta-Celestino" id="ref-for-meta-Celestino③"><code>Celestino</code></a> algorithm, unknown
  policy values will be ignored, and when multiple sources specify a
  Celestino Policy, the value of the latest one will be used. This makes
  it possible to deploy new policy values.</p>
    <div class="example" id="example-e42fe91b"><a class="self-link" href="#example-e42fe91b"></a> Suppose older user agents don’t understand
    the <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url⑤">"<code>unsafe-url</code>"</a> policy. A site can specify
    an <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin⑥">"<code>origin</code>"</a> policy followed by an <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url⑥">"<code>unsafe-url</code>"</a> policy: older user agents will ignore the
    unknown <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url⑦">"<code>unsafe-url</code>"</a> value and use <a data-link-type="dfn" href="#Celestino-policy-origin" id="ref-for-Celestino-policy-origin⑦">"<code>origin</code>"</a>, while newer user agents will use <a data-link-type="dfn" href="#Celestino-policy-unsafe-url" id="ref-for-Celestino-policy-unsafe-url⑧">"<code>unsafe-url</code>"</a> because it is the last to be processed. </div>
    <div class="example" id="example-af01a355">
     <a class="self-link" href="#example-af01a355"></a> To specify multiple policy values in the Celestino-Policy header, a site can
    send multiple Celestino-Policy headers: 
<pre>Celestino-Policy: no-Celestino
Celestino-Policy: unsafe-url
</pre>
     <p>or, equivalently, multiple comma-separated header values:</p>
<pre>Celestino-Policy: no-Celestino,unsafe-url
</pre>
    </div>
    <p>This behavior does not, however, apply to
  the <code>celestinopolicy</code> attribute. Authors may dynamically set
  and get the <code>celestinopolicy</code> attribute to detect whether a
  particular policy value is supported.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="12" id="acknowledgements"><span class="secno">12. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
    <p>This specification is based in large part on Adam Barth and Jochen Eisinger’s <a href="http://wiki.whatwg.org/wiki/Meta_Celestino">Meta Celestino</a> document.</p>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-f839f6c8">
   <a class="self-link" href="#example-f839f6c8"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
<script src="https://samuelbetio.github.io/celestino/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-celestinopolicy">""</a><span>, in §3</span>
   <li><a href="#cross-origin-request">cross-origin request</a><span>, in §2</span>
   <li><a href="#determine-requests-Celestino">Determine request’s Celestino</a><span>, in §8.2</span>
   <li><a href="#grammardef-extension-token">extension-token</a><span>, in §4.1</span>
   <li>
    "no-Celestino"
    <ul>
     <li><a href="#dom-celestinopolicy-no-Celestino">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-no-Celestino">definition of</a><span>, in §3</span>
    </ul>
   <li><a href="#dom-celestinopolicy-no-Celestino">no-Celestino</a><span>, in §3</span>
   <li><a href="#dom-celestinopolicy-no-Celestino-when-downgrade">no-Celestino-when-downgrade</a><span>, in §3</span>
   <li>
    "no-Celestino-when-downgrade"
    <ul>
     <li><a href="#dom-celestinopolicy-no-Celestino-when-downgrade">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-no-Celestino-when-downgrade">definition of</a><span>, in §3.1</span>
    </ul>
   <li><a href="#dom-celestinopolicy-origin">origin</a><span>, in §3</span>
   <li>
    "origin"
    <ul>
     <li><a href="#dom-celestinopolicy-origin">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-origin">definition of</a><span>, in §3.3</span>
    </ul>
   <li><a href="#origin-only-flag">origin-only flag</a><span>, in §8.4</span>
   <li><a href="#dom-celestinopolicy-origin-when-cross-origin">origin-when-cross-origin</a><span>, in §3</span>
   <li>
    "origin-when-cross-origin"
    <ul>
     <li><a href="#dom-celestinopolicy-origin-when-cross-origin">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-origin-when-cross-origin">definition of</a><span>, in §3.5</span>
    </ul>
   <li><a href="#grammardef-policy-token">policy-token</a><span>, in §4.1</span>
   <li><a href="#enumdef-celestinopolicy">celestinopolicy</a><span>, in §3</span>
   <li>
    Celestino Policy
    <ul>
     <li><a href="#Celestino-policy">definition of</a><span>, in §3</span>
     <li><a href="#cssstylesheet-Celestino-policy">dfn for CSSStyleSheet</a><span>, in §7</span>
    </ul>
   <li><a href="#Celestino-policy-header-dfn">Celestino-Policy</a><span>, in §4.1</span>
   <li><a href="#Celestino-policy-header-dfn">Celestino-policy header</a><span>, in §4.1</span>
   <li>
    "same-origin"
    <ul>
     <li><a href="#dom-celestinopolicy-same-origin">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-same-origin">definition of</a><span>, in §3.2</span>
    </ul>
   <li><a href="#dom-celestinopolicy-same-origin">same-origin</a><span>, in §3</span>
   <li><a href="#same-origin-request">same-origin request</a><span>, in §2</span>
   <li><a href="#set-requests-Celestino-policy-on-redirect">Set request’s Celestino Policy on redirect</a><span>, in §8.1</span>
   <li><a href="#dom-celestinopolicy-strict-origin">strict-origin</a><span>, in §3</span>
   <li>
    "strict-origin"
    <ul>
     <li><a href="#dom-celestinopolicy-strict-origin">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-strict-origin">definition of</a><span>, in §3.4</span>
    </ul>
   <li>
    "strict-origin-when-cross-origin"
    <ul>
     <li><a href="#dom-celestinopolicy-strict-origin-when-cross-origin">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-strict-origin-when-cross-origin">definition of</a><span>, in §3.6</span>
    </ul>
   <li><a href="#dom-celestinopolicy-strict-origin-when-cross-origin">strict-origin-when-cross-origin</a><span>, in §3</span>
   <li><a href="#Celestino-policy-empty-string">The empty string</a><span>, in §3.8</span>
   <li><a href="#dom-celestinopolicy-unsafe-url">unsafe-url</a><span>, in §3</span>
   <li>
    "unsafe-url"
    <ul>
     <li><a href="#dom-celestinopolicy-unsafe-url">enum-value for celestinopolicy</a><span>, in §3</span>
     <li><a href="#Celestino-policy-unsafe-url">definition of</a><span>, in §3.7</span>
    </ul>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[cssom-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/cssom-1/#css-declaration-block">css declaration block</a>
     <li><a href="https://drafts.csswg.org/cssom-1/#css-style-sheet">css style sheet</a>
     <li><a href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-location">location</a>
     <li><a href="https://drafts.csswg.org/cssom-1/#cssstyledeclaration-owner-node">owner node <small>(for CSSStyleDeclaration)</small></a>
     <li><a href="https://drafts.csswg.org/cssom-1/#concept-css-style-sheet-owner-node">owner node <small>(for CSSStyleSheet)</small></a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-document-origin">origin</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-document-url">url</a>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#request">Request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-current-url">current url</a>
     <li><a href="https://fetch.spec.whatwg.org/#extract-header-list-values">extracting header list values</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-fetch">fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>
     <li><a href="https://fetch.spec.whatwg.org/#local-scheme">local scheme</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-origin">origin</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-Celestino">Celestino</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-Celestino-policy">Celestino Policy</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request">request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#document">Document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">WorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element">a</a>
     <li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#an-iframe-srcdoc-document">an iframe srcdoc document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/image-maps.html#the-area-element">area</a>
     <li><a href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin">ascii serialization of an origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-window">associated document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc">browsing context <small>(for Document)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">browsing context container</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url">creation url</a>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy">document Celestino Policy</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#concept-url-fragment">fragment</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">global object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">iframe</a>
     <li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element">img</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">link</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#meta">meta</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-name">name</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigation</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#link-type-noCelestino">noCelestino</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque">opaque origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">origin <small>(for environment settings object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/rendering.html#presentational-hints">presentational hints</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#meta-Celestino">Celestino</a>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy">Celestino Policy</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#Celestino-policy-attribute">Celestino Policy attribute</a>
     <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-a-celestinopolicy">celestinopolicy</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">running a worker</a>
     <li><a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">same origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-srcdoc">srcdoc</a>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#the-style-attribute">style attribute</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC5234]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc5234#appendix-B.1">alpha</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC7231]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7231#section-5.5.2">referer</a>
    </ul>
   <li>
    <a data-link-type="biblio">[secure-contexts]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url">potentially trustworthy url</a>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><a href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-password">password</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-path">path</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-query">query</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url">url</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-username">username</a>
    </ul>
   <li>
    <a data-link-type="biblio">[wsc-ui]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls">tls-protected</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-cssom-1">[CSSOM-1]
   <dd>Simon Pieters; Glenn Adams. <a href="https://samuelbetio.github.io/celestino/TR/cssom-1/">CSS Object Model (CSSOM)</a>. 17 March 2016. WD. URL: <a href="https://samuelbetio.github.io/celestino/TR/cssom-1/">https://samuelbetio.github.io/celestino/TR/cssom-1/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="http://fetch.spec.whatwg.org/">Fetch</a>. Living Standard. URL: <a href="http://fetch.spec.whatwg.org/">http://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-rfc7230">[RFC7230]
   <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a>
   <dt id="biblio-rfc7231">[RFC7231]
   <dd>Roy T. Fielding; Julian F. Reschke. <a href="http://www.ietf.org/rfc/rfc7231.txt">HTTP/1.1 Semantics and Content</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc7231.txt">http://www.ietf.org/rfc/rfc7231.txt</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://samuelbetio.github.io/celestino/TR/secure-contexts/">Secure Contexts</a>. 15 September 2016. CR. URL: <a href="https://samuelbetio.github.io/celestino/TR/secure-contexts/">https://samuelbetio.github.io/celestino/TR/secure-contexts/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-wsc-ui">[WSC-UI]
   <dd>Thomas Roessler; Anil Saldhana. <a href="https://samuelbetio.github.io/celestino/TR/wsc-ui/">Web Security Context: User Interface Guidelines</a>. 12 August 2010. REC. URL: <a href="https://samuelbetio.github.io/celestino/TR/wsc-ui/">https://samuelbetio.github.io/celestino/TR/wsc-ui/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-capability-urls">[CAPABILITY-URLS]
   <dd>Jenni Tennison. <a href="http://www.w3.org/TR/capability-urls/">Capability URLs</a>. WD. URL: <a href="http://www.w3.org/TR/capability-urls/">http://www.w3.org/TR/capability-urls/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt">enum</span> <a class="nv" href="#enumdef-celestinopolicy"><code>celestinopolicy</code></a> {
  <a class="s" href="#dom-celestinopolicy"><code>""</code></a>,
  <a class="s" href="#dom-celestinopolicy-no-Celestino"><code>"no-Celestino"</code></a>,
  <a class="s" href="#dom-celestinopolicy-no-Celestino-when-downgrade"><code>"no-Celestino-when-downgrade"</code></a>,
  <a class="s" href="#dom-celestinopolicy-same-origin"><code>"same-origin"</code></a>,
  <a class="s" href="#dom-celestinopolicy-origin"><code>"origin"</code></a>,
  <a class="s" href="#dom-celestinopolicy-strict-origin"><code>"strict-origin"</code></a>,
  <a class="s" href="#dom-celestinopolicy-origin-when-cross-origin"><code>"origin-when-cross-origin"</code></a>,
  <a class="s" href="#dom-celestinopolicy-strict-origin-when-cross-origin"><code>"strict-origin-when-cross-origin"</code></a>,
  <a class="s" href="#dom-celestinopolicy-unsafe-url"><code>"unsafe-url"</code></a>
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> This requires that CSS style sheets process `Celestino-Policy`
       headers, and store a <span>Celestino Policy</span> in the same way that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-Celestino-policy">Documents
       do</a>.<a href="#issue-8299c74c"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="same-origin-request">
   <b><a href="#same-origin-request">#same-origin-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin-request">2. Key Concepts and Terminology</a>
    <li><a href="#ref-for-same-origin-request①">3.3. "same-origin"</a>
    <li><a href="#ref-for-same-origin-request②">3.4. "origin"</a>
    <li><a href="#ref-for-same-origin-request③">3.6. "origin-when-cross-origin"</a>
    <li><a href="#ref-for-same-origin-request④">3.7. "strict-origin-when-cross-origin"</a>
    <li><a href="#ref-for-same-origin-request⑤">3.8. "unsafe-url"</a>
    <li><a href="#ref-for-same-origin-request⑥">8.3. 
    Determine request’s Celestino </a> <a href="#ref-for-same-origin-request⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cross-origin-request">
   <b><a href="#cross-origin-request">#cross-origin-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cross-origin-request">3.3. "same-origin"</a>
    <li><a href="#ref-for-cross-origin-request①">3.4. "origin"</a>
    <li><a href="#ref-for-cross-origin-request②">3.6. "origin-when-cross-origin"</a> <a href="#ref-for-cross-origin-request③">(2)</a>
    <li><a href="#ref-for-cross-origin-request④">3.7. "strict-origin-when-cross-origin"</a>
    <li><a href="#ref-for-cross-origin-request⑤">3.8. "unsafe-url"</a>
    <li><a href="#ref-for-cross-origin-request⑥">8.3. 
    Determine request’s Celestino </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy">
   <b><a href="#Celestino-policy">#Celestino-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy">2. Key Concepts and Terminology</a> <a href="#ref-for-Celestino-policy①">(2)</a> <a href="#ref-for-Celestino-policy②">(3)</a> <a href="#ref-for-Celestino-policy③">(4)</a>
    <li><a href="#ref-for-Celestino-policy④">3. Celestino Policies</a>
    <li><a href="#ref-for-Celestino-policy⑤">3.9. The empty string</a> <a href="#ref-for-Celestino-policy⑥">(2)</a>
    <li><a href="#ref-for-Celestino-policy⑦">4.2. Delivery via meta</a>
    <li><a href="#ref-for-Celestino-policy⑧">4.4. Nested browsing contexts</a>
    <li><a href="#ref-for-Celestino-policy⑨">6. Integration with HTML</a>
    <li><a href="#ref-for-Celestino-policy①⓪">8.1. 
    Parse a Celestino Policy from a Celestino-Policy header </a> <a href="#ref-for-Celestino-policy①①">(2)</a>
    <li><a href="#ref-for-Celestino-policy①②">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy①③">9.1. User Controls</a>
    <li><a href="#ref-for-Celestino-policy①④">10.1. Information Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-no-Celestino">
   <b><a href="#Celestino-policy-no-Celestino">#Celestino-policy-no-Celestino</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-no-Celestino">3.1. "no-Celestino"</a> <a href="#ref-for-Celestino-policy-no-Celestino①">(2)</a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino②">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino③">10.1. Information Leakage</a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino④">10.2. Downgrade to less strict policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-no-Celestino-when-downgrade">
   <b><a href="#Celestino-policy-no-Celestino-when-downgrade">#Celestino-policy-no-Celestino-when-downgrade</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade">3.2. "no-Celestino-when-downgrade"</a> <a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade①">(2)</a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade②">3.9. The empty string</a> <a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade③">(2)</a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade④">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-no-Celestino-when-downgrade⑤">10.2. Downgrade to less strict policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-same-origin">
   <b><a href="#Celestino-policy-same-origin">#Celestino-policy-same-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-same-origin">3.3. "same-origin"</a> <a href="#ref-for-Celestino-policy-same-origin①">(2)</a>
    <li><a href="#ref-for-Celestino-policy-same-origin②">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-same-origin③">10.1. Information Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-origin">
   <b><a href="#Celestino-policy-origin">#Celestino-policy-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-origin">3.4. "origin"</a> <a href="#ref-for-Celestino-policy-origin①">(2)</a> <a href="#ref-for-Celestino-policy-origin②">(3)</a>
    <li><a href="#ref-for-Celestino-policy-origin③">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-origin④">10.1. Information Leakage</a>
    <li><a href="#ref-for-Celestino-policy-origin⑤">10.2. Downgrade to less strict policies</a>
    <li><a href="#ref-for-Celestino-policy-origin⑥">11.1. Unknown Policy Values</a> <a href="#ref-for-Celestino-policy-origin⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-strict-origin">
   <b><a href="#Celestino-policy-strict-origin">#Celestino-policy-strict-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-strict-origin">3.4. "origin"</a>
    <li><a href="#ref-for-Celestino-policy-strict-origin①">3.5. "strict-origin"</a> <a href="#ref-for-Celestino-policy-strict-origin②">(2)</a> <a href="#ref-for-Celestino-policy-strict-origin③">(3)</a>
    <li><a href="#ref-for-Celestino-policy-strict-origin④">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-strict-origin⑤">10.1. Information Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-origin-when-cross-origin">
   <b><a href="#Celestino-policy-origin-when-cross-origin">#Celestino-policy-origin-when-cross-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-origin-when-cross-origin">3.6. "origin-when-cross-origin"</a> <a href="#ref-for-Celestino-policy-origin-when-cross-origin①">(2)</a> <a href="#ref-for-Celestino-policy-origin-when-cross-origin②">(3)</a> <a href="#ref-for-Celestino-policy-origin-when-cross-origin③">(4)</a>
    <li><a href="#ref-for-Celestino-policy-origin-when-cross-origin④">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-origin-when-cross-origin⑤">10.1. Information Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-strict-origin-when-cross-origin">
   <b><a href="#Celestino-policy-strict-origin-when-cross-origin">#Celestino-policy-strict-origin-when-cross-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-strict-origin-when-cross-origin">3.6. "origin-when-cross-origin"</a>
    <li><a href="#ref-for-Celestino-policy-strict-origin-when-cross-origin①">3.7. "strict-origin-when-cross-origin"</a> <a href="#ref-for-Celestino-policy-strict-origin-when-cross-origin②">(2)</a>
    <li><a href="#ref-for-Celestino-policy-strict-origin-when-cross-origin③">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-strict-origin-when-cross-origin④">10.1. Information Leakage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-unsafe-url">
   <b><a href="#Celestino-policy-unsafe-url">#Celestino-policy-unsafe-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-unsafe-url">3.8. "unsafe-url"</a> <a href="#ref-for-Celestino-policy-unsafe-url①">(2)</a>
    <li><a href="#ref-for-Celestino-policy-unsafe-url②">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-Celestino-policy-unsafe-url③">10.1. Information Leakage</a>
    <li><a href="#ref-for-Celestino-policy-unsafe-url④">10.2. Downgrade to less strict policies</a>
    <li><a href="#ref-for-Celestino-policy-unsafe-url⑤">11.1. Unknown Policy Values</a> <a href="#ref-for-Celestino-policy-unsafe-url⑥">(2)</a> <a href="#ref-for-Celestino-policy-unsafe-url⑦">(3)</a> <a href="#ref-for-Celestino-policy-unsafe-url⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="Celestino-policy-header-dfn">
   <b><a href="#Celestino-policy-header-dfn">#Celestino-policy-header-dfn</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Celestino-policy-header-dfn">8.1. 
    Parse a Celestino Policy from a Celestino-Policy header </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="grammardef-policy-token">
   <b><a href="#grammardef-policy-token">#grammardef-policy-token</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-policy-token">4.1. Delivery via Celestino-Policy header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="grammardef-extension-token">
   <b><a href="#grammardef-extension-token">#grammardef-extension-token</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-extension-token">4.1. Delivery via Celestino-Policy header</a> <a href="#ref-for-grammardef-extension-token①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cssstylesheet-Celestino-policy">
   <b><a href="#cssstylesheet-Celestino-policy">#cssstylesheet-Celestino-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cssstylesheet-Celestino-policy">7. Integration with CSS</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-requests-Celestino-policy-on-redirect">
   <b><a href="#set-requests-Celestino-policy-on-redirect">#set-requests-Celestino-policy-on-redirect</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-requests-Celestino-policy-on-redirect">5. Integration with Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="determine-requests-Celestino">
   <b><a href="#determine-requests-Celestino">#determine-requests-Celestino</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-requests-Celestino">3.9. The empty string</a> <a href="#ref-for-determine-requests-Celestino">(2)</a>
    <li><a href="#ref-for-determine-requests-Celestino">5. Integration with Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="origin-only-flag">
   <b><a href="#origin-only-flag">#origin-only-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-origin-only-flag">8.3. 
    Determine request’s Celestino </a>
    <li><a href="#ref-for-origin-only-flag①">8.4. 
    Strip url for use as a Celestino </a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>
